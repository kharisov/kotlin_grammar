# Project
Target language independent ANTLR4 grammar for Kotlin.

## Known bugs and erroneous behavior
1. Several annotated lambdas are allowed in call suffix:
```
foo(){}{}{} //is parsed as valid function call with 3 call suffixes
```

## Noticeable behavior
1. Though enum classes and ordinary classes are parsed in different ways, ordinary classes and interfaces are parsed in the same way with the only difference in keyword. This leads to correct parsing of incorrect structures. For example interfaces with constructors:
```
interface A constructor(val b: Int) //is parsed as valid interface declaration
```
Same with abstract functions which are parsed as normal functions and therefore allowed to have bodies:
```
abstract fun foo() { print("I have body") } //is parsed as valid function declaration
```

## About tests
Parser was tested on test data that might be found in official Kotlin repository: https://github.com/JetBrains/kotlin/tree/master/compiler/testData/psi

There are two fast written (and so quite messy) programs in tests folder which I used for testing parser:
1. CompilerTester is java script that gets the folder (. by default), recursively searches for .kt files and tries to compile them with kotlin compiler (just creates new process with ProcessBuilder and gives it command: "kotlinc.bat" + filename). The output of compiler is written to file which has the same name as .kt source one, but with .txt extension. Also it checks if output contains errors and if so, it appends the name of the file in exceptionsFile (exceptions.txt by default).
   It is possible to pass one or two command line arguments to programm. First of them is always considered as input folder name and second one as output file.
   
2. ParserTester is java script. It is using classes generated by ANTLR and also ANTLR library. It gets the folder (. by default), recursively searches for .kt files and tries to parse them using ANTLR generated parser. (jar file has all the dependencies inside, so it might be executed without installed antlr)
   It is possible to pass one or two command line arguments to programm. First of them is always considered as input folder name and second one as exceptionsFile with names or absolute pathes of tests that a meant to be not parsed (by default this file is not used).
   For each file being parsed there are four possible outputs:
   a) "Test passed!" - File correctly parsed and it's name is not in the exceptionsFile.
   b) "Test failed! This test was meant to be erroneous, but it passed" - File correctly parsed, but it's name was in the exceptionsFile. In this case output is also duplicated in mismatched.txt file.
   c) "Test passed! This test was meant to be erroneous" - File was not correctly parsed, but its name was in the exceptionsFile.
   d) "Test failed!" - File was not correctly barsed and it's name is not in the exceptionsFile. In this case output is also duplicated in mismatched.txt file.

So at first I used CompilerTester to get exceptions.txt file. Then this file was used as second argument of ParserTester. After that mismatched.txt file contained names of tests, on which results of compiler and parser works differs. There were 107 out of 405 such files. As for them, I had to check myself, if compiler error had a syntax or semantic nature. After all, i came to result of passing 404 of 405 tests. Cases of failed tests are described above.

Also parser was test with ParserTester on some open source github projects and it showed a pretty good result of 100% parsing.
